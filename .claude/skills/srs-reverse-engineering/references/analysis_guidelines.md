# SRS逆向工程分析指南

## 概述

本指南提供了通过逆向工程分析现有代码库，生成软件需求规格说明书（SRS）的详细方法论。

## 分析方法论

### 第一阶段：数据收集

#### 1.1 非代码资产收集
**优先级：高**
- **UI/UX原型文件**: Axure, Figma, Sketch等设计文件
- **数据库架构**: ER图、SQL创建脚本、Prisma schema
- **API文档**: Swagger/OpenAPI规范、Postman集合
- **用户手册**: 系统使用说明和帮助文档

#### 1.2 代码资产收集
**优先级：中**
- **源代码**: 业务逻辑、控制层、服务层代码
- **配置文件**: 数据库配置、中间件配置、环境配置
- **测试用例**: 单元测试、集成测试、端到端测试
- **部署脚本**: Dockerfile、CI/CD配置

### 第二阶段：深入分析

#### 2.1 数据库分析
**目标**: 提取数据模型和业务规则

**分析要点**:
- 识别主键、外键关系 → 理解实体间关系
- 分析字段约束 → 提取业务规则
- 查看索引设计 → 了解性能需求
- 分析触发器和存储过程 → 理解复杂业务逻辑

**输出**: 数据字典、实体关系图

#### 2.2 API接口分析
**目标**: 理解系统对外提供服务

**分析要点**:
- 按功能模块分组API端点
- 分析请求/响应数据结构
- 识别认证和授权机制
- 理解错误处理和状态码

**输出**: API接口文档、功能模块划分

#### 2.3 代码结构分析
**目标**: 理解系统架构和业务逻辑

**分析要点**:
- 识别架构模式（MVC、分层、微服务等）
- 分析业务逻辑层的核心规则
- 理解数据流和控制流
- 识别设计模式和最佳实践

**输出**: 架构图、业务规则清单

### 第三阶段：需求重构

#### 3.1 功能需求重构
- 基于API端点生成功能需求
- 基于业务规则补充验收标准
- 基于用户流程描述使用场景

#### 3.2 非功能需求推断
- 从代码模式推断性能要求
- 从安全机制推断安全需求
- 从架构设计推断可扩展性需求

## 工具使用指南

### 数据库分析工具
```bash
# 分析数据库结构
python scripts/analyze_database.py /path/to/project --output ./analysis

# 支持的文件类型:
# - SQL创建脚本 (*.sql)
# - Prisma schema (schema.prisma)
# - 数据库迁移文件
```

### API发现工具
```bash
# 自动发现API端点
python scripts/discover_apis.py /path/to/project --output ./analysis

# 支持的框架:
# - Node.js: Express, Fastify
# - Python: Flask, FastAPI, Django
# - Java: Spring Boot
# - Go: Gin, Echo
```

### 代码结构分析工具
```bash
# 分析代码结构和业务规则
python scripts/analyze_code_structure.py /path/to/project --output ./analysis

# 分析内容:
# - 项目架构模式
# - 类和函数结构
# - 业务规则提取
# - 依赖关系分析
```

### SRS生成工具
```bash
# 生成SRS文档
python scripts/generate_srs_template.py --analysis ./analysis --output ./SRS_DOCUMENT.md
```

## 质量检查清单

### 数据完整性检查
- [ ] 所有数据库表都已识别
- [ ] 主要API端点都已发现
- [ ] 核心业务逻辑都已提取
- [ ] 关键配置参数都已记录

### 需求准确性检查
- [ ] 功能需求覆盖了主要用户场景
- [ ] 非功能需求基于代码实现推断
- [ ] 数据需求与实际数据库结构一致
- [ ] 接口需求与API文档匹配

### 文档质量检查
- [ ] 需求描述清晰、无歧义
- [ ] 验收标准可测试、可验证
- [ ] 术语使用一致
- [ ] 文档结构完整、层次清晰

## 常见问题和解决方案

### Q1: 如何处理不完整的信息？
**A**: 在文档中明确标注"待确认"或"基于代码推断"，建议与项目相关人员进一步确认。

### Q2: 如何平衡分析深度和效率？
**A**: 优先分析核心业务模块和关键路径，对于辅助功能可以简化处理。

### Q3: 如何验证分析结果的准确性？
**A**: 通过多种方式交叉验证：代码审查、与开发人员交流、运行系统验证等。

### Q4: 如何处理动态行为？
**A**: 结合静态代码分析和动态运行观察，必要时查看日志和监控数据。

## 最佳实践

1. **迭代分析**: 分阶段进行分析，逐步完善需求文档
2. **多方验证**: 与开发、测试、产品等不同角色的人员交流验证
3. **工具辅助**: 充分利用自动化工具提高分析效率
4. **文档标注**: 明确标注分析方法、推断过程和不确定性
5. **持续更新**: 随着系统变化及时更新SRS文档

## 参考资源

- IEEE 830-1998: Recommended Practice for Software Requirements Specifications
- 软件工程知识体系（SWEBOK Guide）
- 敏捷需求分析最佳实践
- 逆向工程技术文档